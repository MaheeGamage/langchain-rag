# Session: 2026-02-23 #004

## Goal
Add Docker support to deploy the full RAG stack (FastAPI API, Streamlit UI, and
Ollama model server) using Docker Compose, then update docs to reflect the changes.

## Prompts Summary
- "Create relevant dockerfiles and docker compose file to deploy the app including ollama"
- "Update both agents.MD and readme.md files where necessary about this change"

## Actions Taken
- Created `Dockerfile` — two-stage build (Poetry + `poetry-plugin-export` → requirements
  export, then slim runtime image). Copies `app/`, `ui/`, and `run.py`. Exposes ports
  8000 and 8501.
- Created `docker-compose.yml` — four services:
  - `ollama`: official `ollama/ollama` image, port 11434, `ollama_data` named volume,
    health-check, optional NVIDIA GPU deploy block (commented).
  - `ollama-init`: one-shot service that pulls `tinyllama` and `nomic-embed-text`
    once Ollama is healthy; uses `OLLAMA_LLM_MODEL` / `OLLAMA_EMBEDDING_MODEL` from
    `.env` with fallback defaults.
  - `api`: builds from `Dockerfile`, tagged as `langchain-rag`, runs `uvicorn`,
    mounts `./chroma_db` and `./data`, overrides `OLLAMA_BASE_URL=http://ollama:11434`.
  - `ui`: reuses `langchain-rag` image (no `build:`), runs `streamlit`, same Ollama
    override. `chroma_db` not mounted (UI queries via `app.graph` which reads ChromaDB).
- Created `.dockerignore` — excludes `.venv/`, `__pycache__/`, `chroma_db/`, `data/`,
  `.env`, `.git/`, `.vscode/`, `.agent/`, docs.
- Fixed `Dockerfile` build error: added `poetry-plugin-export` to the builder stage pip
  install (Poetry 2.x no longer bundles the export plugin).
- Updated `README.md`:
  - Fixed standalone Streamlit command to `ui/streamlit_app.py`.
  - Updated project structure tree (added `ui/`, Docker files, bind-mount notes).
  - Added **Run with Docker** section.
- Updated `AGENTS.md`:
  - Section 2: fixed Streamlit path; added Docker run/ingest commands and image layout.
  - Section 3: updated project structure tree.
  - Section 4: updated Streamlit UI path reference.
  - Section 5: updated rule to "keep inside `ui/`".
  - Section 7: added three new pitfalls (build conflict, baking volumes, localhost URL).

## Outcome
Full Docker Compose stack working. Users start with `docker compose up --build`.
Ingest PDFs with `docker compose run --rm api python -m app.ingest`. Docs updated.

## Agent
GitHub Copilot (Claude Sonnet 4.6)
